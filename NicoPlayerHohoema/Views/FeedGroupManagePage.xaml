<Page
    x:Name="PageRoot"
    x:Class="NicoPlayerHohoema.Views.FeedGroupManagePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:NicoPlayerHohoema.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:toolkit="using:WinRTXamlToolkit.Controls"
    xmlns:mvvm="using:Prism.Windows.Mvvm"
    xmlns:mybehavior="using:NicoPlayerHohoema.Views.Behaviors"
    xmlns:ext="using:WinRTXamlToolkit.Controls.Extensions"
    xmlns:controls="using:NicoPlayerHohoema.Views.Controls"
    mvvm:ViewModelLocator.AutoWireViewModel="True"
    mc:Ignorable="d">
    
    
    <Page.Resources>

        <Style x:Key="FeedItemSourceTextBlockStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12" />
        </Style>
        

        <DataTemplate x:Key="TagFeedItemSourceTemplate">
            <Border>
                <TextBlock Text="{Binding Name}" 
                           Style="{StaticResource FeedItemSourceTextBlockStyle}"
                           />
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="MylistFeedItemSourceTemplate">
            <Border>
                <TextBlock Text="{Binding Name}"
                           Style="{StaticResource FeedItemSourceTextBlockStyle}"
                           />
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="UserFeedItemSourceTemplate">
            <Border>
                <TextBlock Text="{Binding Name}"
                           Style="{StaticResource FeedItemSourceTextBlockStyle}"
                           />
            </Border>
        </DataTemplate>


        <local:FeedItemSourceTemplateSelector x:Key="feedItemSourceTemplateSelector"
                                              Tag="{StaticResource TagFeedItemSourceTemplate}"
                                              Mylist="{StaticResource MylistFeedItemSourceTemplate}"
                                              User="{StaticResource UserFeedItemSourceTemplate}"
            />
    </Page.Resources>
    <Grid>

        <toolkit:DockPanel >


            <toolkit:DockPanel toolkit:DockPanel.Dock="Top">

                <StackPanel Orientation="Horizontal" toolkit:DockPanel.Dock="Left" Margin="8">

                    <AppBarButton Icon="Add" 
                                  Label="フィードグループ 作成">
                        <AppBarButton.Flyout>
                            <Flyout>
                                <StackPanel Orientation="Horizontal">
                                    

                                    <TextBox Text="{Binding NewFeedGroupName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Width="150"
                                             >
                                        <TextBox.Header>
                                            <TextBlock Text="フィードグループ名"
                                                       FontSize="12"
                                                       />
                                        </TextBox.Header>

                                    </TextBox>
                                    <Button Content="作成"
                                            Command="{Binding AddFeedGroupCommand}"
                                            Width="80"
                                            Margin="16 8"
                                            />
                                </StackPanel>
                            </Flyout>
                        </AppBarButton.Flyout>
                    </AppBarButton>

                </StackPanel>
                
                
                <Border />
                
            </toolkit:DockPanel>

            


            <ListView ItemsSource="{Binding FeedGroupItems}"
                      IsMultiSelectCheckBoxEnabled="{Binding IsSelectionModeEnable.Value}"
                      SelectedItem="{Binding SelectedFeedGroupItem.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      SelectionMode="Single"
                  >

                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment"
                                    Value="Stretch" 
                                        />
                        <Setter Property="Margin"
                                    Value="0 0 0 8" 
                                    />
                    </Style>
                </ListView.ItemContainerStyle>


                <ListView.ItemTemplate>

                    <DataTemplate>

                        <Grid Height="48" Background="Transparent" IsHitTestVisible="True" Margin="0 8">

                            <i:Interaction.Behaviors>
                                <core:EventTriggerBehavior EventName="Tapped">
                                    <core:InvokeCommandAction Command="{Binding ElementName=PageRoot, Path=DataContext.OpenFeedVideoPageCommand}"
                                                          CommandParameter="{Binding}"
                                                          />
                                </core:EventTriggerBehavior>
                            </i:Interaction.Behaviors>


                            
                            <toolkit:DockPanel>

                                <StackPanel toolkit:DockPanel.Dock="Right"
                                            Orientation="Horizontal"
                                            >


                                    
                                    <Border Margin="8 0">
                                        <TextBlock VerticalAlignment="Center"
                                                    Margin="8"
                                                >
                                                <Run Text="{Binding UnreadItemCount}" />
                                        </TextBlock>
                                    </Border>

                                    <AppBarButton Icon="Edit" 
                                            IsCompact="True"
                                            Command="{Binding SecondaryActionCommand}"
                                            />
                                    
                                    
                                </StackPanel>


                                <ItemsControl ItemsSource="{Binding SourceItems}"
                                          ItemTemplateSelector="{StaticResource feedItemSourceTemplateSelector}"
                                          toolkit:DockPanel.Dock="Bottom"
                                            >
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>

                                </ItemsControl>

                                
                                <StackPanel>
                                    <TextBlock Text="{Binding Label}" Margin="8"
                                               VerticalAlignment="Center"
                                               />

                                </StackPanel>



                            </toolkit:DockPanel>


                        </Grid>
                    </DataTemplate>

                </ListView.ItemTemplate>
            </ListView>



        </toolkit:DockPanel>


        
    </Grid>

</Page>
