<ContentControl
    x:Name="RootLayout"
    x:Class="NicoPlayerHohoema.Views.MenuNavigatePageBase"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:NicoPlayerHohoema.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:toolkit="using:WinRTXamlToolkit.Controls"
    xmlns:mvvm="using:Prism.Windows.Mvvm"
    xmlns:mybehavior="using:NicoPlayerHohoema.Views.Behaviors"
    xmlns:ext="using:WinRTXamlToolkit.Controls.Extensions"
    xmlns:logicalTrigger="using:AdaptiveTriggerLibrary.Triggers.LogicalTriggers"
    xmlns:uiTrigger="using:AdaptiveTriggerLibrary.Triggers.UserInterfaceTriggers"
    xmlns:interactionTrigger="using:AdaptiveTriggerLibrary.Triggers.UserInteractionTriggers"
    xmlns:hardwareTrigger="using:AdaptiveTriggerLibrary.Triggers.HardwareInterfaceTriggers"
    xmlns:softwareTrigger="using:AdaptiveTriggerLibrary.Triggers.SoftwareInterfaceTriggers"
    xmlns:iconPack="using:MahApps.Metro.IconPacks"
    mvvm:ViewModelLocator.AutoWireViewModel="True"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="400"    
    >

    <ContentControl.Resources>
        

        <DataTemplate x:Key="HohoemaContentTemplate">
            
        </DataTemplate>
    </ContentControl.Resources>
    
    
    <ContentControl.Template>
        <ControlTemplate>

            <Grid>

                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="TopBarStateGroup">

                        
                        <!-- トップメニュー非表示 -->
                        <VisualState>
                            <VisualState.StateTriggers>
                                <StateTrigger IsActive="{Binding IsVisibleMenu.Value, Converter={StaticResource InvertBoolean}}" />
                            </VisualState.StateTriggers>
                            <VisualState.Setters>
                                <Setter Target="XboxTopBar.Visibility" Value="Collapsed" />
                                <Setter Target="DesktopTopBar.Visibility" Value="Collapsed" />
                                <Setter Target="MobileTopBar.Visibility" Value="Collapsed" />
                            </VisualState.Setters>
                        </VisualState>

                        <!-- Xbox または XInput画面の強制表示 -->
                        <VisualState>
                            <VisualState.StateTriggers>
                                
                                <hardwareTrigger:DeviceFamilyTrigger Condition="Xbox" />
                                <StateTrigger IsActive="{Binding IsForceXInputModeEnable.Value}" />
                                
                                <AdaptiveTrigger MinWindowWidth="1366" />
                            </VisualState.StateTriggers>
                            <VisualState.Setters>
                                <Setter Target="XboxTopBar.Visibility" Value="Visible" />
                                <Setter Target="DesktopTopBar.Visibility" Value="Collapsed" />
                                <Setter Target="MobileTopBar.Visibility" Value="Collapsed" />
                            </VisualState.Setters>
                        </VisualState>

                        <!-- マウス操作時、または画面が大きい時 -->
                        <VisualState>
                            <VisualState.StateTriggers>
                                <AdaptiveTrigger MinWindowWidth="800" />
                            </VisualState.StateTriggers>
                            <VisualState.Setters>
                                <Setter Target="XboxTopBar.Visibility" Value="Collapsed" />
                                <Setter Target="DesktopTopBar.Visibility" Value="Visible" />
                                <Setter Target="MobileTopBar.Visibility" Value="Collapsed" />
                            </VisualState.Setters>
                        </VisualState>
                        
                        <!-- 狭い -->
                        <VisualState>
                            <VisualState.StateTriggers>
                                <AdaptiveTrigger MinWindowWidth="0" />
                            </VisualState.StateTriggers>
                            <VisualState.Setters>
                                <Setter Target="XboxTopBar.Visibility" Value="Collapsed" />
                                <Setter Target="DesktopTopBar.Visibility" Value="Collapsed" />
                                <Setter Target="MobileTopBar.Visibility" Value="Visible" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>

                </VisualStateManager.VisualStateGroups>

               

                

                <Border x:Name="RootLayout">

                    <toolkit:DockPanel>

                        <!-- Xbox表示時のトップエリア -->
                        <toolkit:DockPanel x:Name="XboxTopBar"
                            toolkit:DockPanel.Dock="Top"
                                           Margin="0 0 0 48"
                                           >
                            <TextBlock Text="{Binding TitleText}"
                                       toolkit:DockPanel.Dock="Left"
                                       Style="{StaticResource HeaderTextBlockStyle}"
                                       />

                            <!-- アカウント情報やフィードの動画件数？ -->

                        </toolkit:DockPanel>

                        
                        <!-- デスクトップ時のトップバー -->
                        <toolkit:DockPanel x:Name="DesktopTopBar"
                            toolkit:DockPanel.Dock="Top" >

                            <!-- デスクトップのトップエリア、サブ項目 -->
                            <StackPanel toolkit:DockPanel.Dock="Right"
                                        Orientation="Horizontal"
                                        >
                                <Button>



                                    <StackPanel>
                                        <SymbolIcon Symbol="People" Height="48" Width="48"
                                                    Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibilityInverted}}"
                                                    />
                                        <Image Source="{Binding UserIconUrl}" 
                                               toolkit:DockPanel.Dock="Left"
                                               Height="32" Width="32"
                                               Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibility}}"
                                                               />
                                    </StackPanel>
                                    
                                    <Button.Flyout>
                                        <Flyout>
                                            <StackPanel>

                                                <!-- アカウント -->

                                                <Button Background="Transparent" 
                                                        Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibility}}"
                                                        Command="{Binding OpenAccountInfoCommand}"
                                                        >
                                                    <toolkit:DockPanel Margin="0 4">

                                                        <Image Source="{Binding UserIconUrl}" 
                                                               toolkit:DockPanel.Dock="Left"
                                                               Height="32" Width="32"
                                                               Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibility}}"
                                                               Margin="0 0 8 0"
                                                               />

                                                        <StackPanel>
                                                            <TextBlock Text="{Binding UserName}" />
                                                            <TextBlock Text="{Binding UserMail}" FontWeight="Light" />
                                                        </StackPanel>
                                                    </toolkit:DockPanel>
                                                </Button>

                                                <ListView ItemsSource="{Binding SubMenuItems}"
                                                          SelectedItem="{Binding SubSelectedItem.Value, Mode=TwoWay}"
                                                          SelectionMode="Single"
                                                          DisplayMemberPath="Label"
                                                    >
                                                    <ListView.ItemContainerStyle>
                                                        <Style TargetType="ListViewItem">
                                                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                        </Style>
                                                    </ListView.ItemContainerStyle>
                                                </ListView>
                                            </StackPanel>
                                        </Flyout>
                                    </Button.Flyout>
                                </Button>

                                <StackPanel Orientation="Horizontal" Margin="8 0 0 0">
                                    <TextBox Text="{Binding SearchText}" 
                                            PlaceholderText="動画を検索"   
                                             Width="200"
                                               />
                                    <Button Height="48" Width="48">
                                        <SymbolIcon Symbol="Find" />
                                    </Button>
                                    <Button Width="24">
                                        <iconPack:PackIconMaterial Kind="ArrowDown" />
                                    </Button>
                                </StackPanel>
                                
                            </StackPanel>

                            <!-- デスクトップのトップエリア、メイン項目 -->
                            <ListView ItemsSource="{Binding MenuItems}"
                                      SelectedItem="{Binding MainSelectedItem.Value, Mode=TwoWay}"
                                      SelectionMode="Single"
                                      DisplayMemberPath="Label"
                                          >
                                <ListView.ItemContainerStyle>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    </Style>
                                </ListView.ItemContainerStyle>
                                <ListView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ListView.ItemsPanel>

                            </ListView>

                        </toolkit:DockPanel>

                        <!-- モバイル時のトップバー -->
                        <Grid x:Name="MobileTopBar"
                            toolkit:DockPanel.Dock="Top">
                            <toolkit:DockPanel>
                                <Button toolkit:DockPanel.Dock="Left"
                                    Height="48"
                                    Width="48"
                                    Background="Transparent"
                                >
                                    <iconPack:PackIconMaterial Kind="Menu" />

                                    <i:Interaction.Behaviors>
                                        <core:EventTriggerBehavior EventName="Tapped">
                                            <core:InvokeCommandAction Command="{Binding TogglePaneOpenCommand}" />
                                        </core:EventTriggerBehavior>
                                    </i:Interaction.Behaviors>
                                </Button>

                                <!-- モバイルレイアウトの検索開始ボタン -->
                                <Button toolkit:DockPanel.Dock="Right"
                                        Height="48"
                                        Width="48"
                                        Background="Transparent"
                                        >
                                    <SymbolIcon Symbol="Find" />
                                </Button>
                                        
                                <TextBlock Text="{Binding TitleText}"
                                           Margin="8 0 0 0"
                                           Style="{StaticResource TitleTextBlockStyle}"
                                           VerticalAlignment="Center"
                                           />
                                
                            </toolkit:DockPanel>

                        </Grid>
                        
                        
                       
                        <SplitView x:Name="SplitView" 
                            CompactPaneLength="48"
                            OpenPaneLength="220"
                            DisplayMode="Overlay"
                            IsPaneOpen="{Binding IsOpenPane.Value, Mode=TwoWay}"
                           >
                            <SplitView.Pane>
                                <toolkit:DockPanel x:Name="PaneLayout">

                                    <Button Background="Transparent" 
                                            Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibility}}"
                                            Command="{Binding OpenAccountInfoCommand}"
                                            toolkit:DockPanel.Dock="Bottom"
                                            HorizontalAlignment="Stretch"
                                                        >
                                        <toolkit:DockPanel Margin="0 0">

                                            <Image Source="{Binding UserIconUrl}" 
                                                   toolkit:DockPanel.Dock="Left"
                                                   Height="32" Width="32"
                                                   Margin="0 0 8 0"
                                                               />

                                            <StackPanel>
                                                <TextBlock Text="{Binding UserName}" />
                                                <TextBlock Text="{Binding UserMail}" FontWeight="Light" />
                                            </StackPanel>
                                        </toolkit:DockPanel>
                                    </Button>


                                    <ScrollViewer HorizontalScrollMode="Disabled"
                                        VerticalScrollMode="Auto"
                                        VerticalScrollBarVisibility="Hidden"
                                        >

                                        <StackPanel>

                                            <ListView ItemsSource="{Binding MenuItems}"
                                                      SelectedItem="{Binding MainSelectedItem.Value, Mode=TwoWay}"
                                                      SelectionMode="Single"
                                                      DisplayMemberPath="Label"
                                                  >
                                                <ListView.ItemContainerStyle>
                                                    <Style TargetType="ListViewItem">
                                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                    </Style>
                                                </ListView.ItemContainerStyle>
                                            </ListView>

                                            <Border BorderBrush="{ThemeResource ApplicationSecondaryForegroundThemeBrush}"
                                                    BorderThickness="0 1 0 0" />

                                            <ListView ItemsSource="{Binding SubMenuItems}"
                                                      SelectedItem="{Binding SubSelectedItem.Value, Mode=TwoWay}"
                                                      SelectionMode="Single"
                                                      DisplayMemberPath="Label"
                                                  >
                                                <ListView.ItemContainerStyle>
                                                    <Style TargetType="ListViewItem">
                                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                    </Style>
                                                </ListView.ItemContainerStyle>
                                            </ListView>

                                        </StackPanel>



                                    </ScrollViewer>
                                </toolkit:DockPanel>
                            </SplitView.Pane>
                            <SplitView.Content>
                                <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" >
                                    <toolkit:DockPanel x:Name="ContentLayout">

                                        <ContentPresenter
                                                Visibility="{Binding NowNavigating.Value, Converter={StaticResource BooleanToVisibilityInverted}}"
                                                />

                                    </toolkit:DockPanel>
                                    <Border Visibility="{Binding HasBGUpdateText.Value, Converter={StaticResource BooleanToVisibility}}"
                                            Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Bottom"
                                            Padding="2"
                                            >
                                        <TextBlock Text="{Binding BGUpdateText.Value}"
                                            FontSize="12"
                                            Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}"
                                            />
                                    </Border>

                                </Grid>

                            </SplitView.Content>
                        </SplitView>

                    </toolkit:DockPanel>

                    
                </Border>



                <Grid Visibility="{Binding NowWorking, Converter={StaticResource BooleanToVisibility}}">

                    <Border Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Opacity="0.8" />
                    
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" MinWidth="400">

                        <TextBlock Text="{Binding WorkTitle}"
                                   FontSize="20"
                                   />

                        <StackPanel Margin="0 16">

                            <!--
                            <TextBlock HorizontalAlignment="Right" FontSize="12">
                                <Run Text="{Binding WorkCount}" />
                                <Run Text="/" />
                                <Run Text="{Binding WorkTotalCount}" />
                            </TextBlock>
                            -->
                            
                            <ProgressBar Minimum="0" Maximum="{Binding WorkTotalCount}"
                                     Value="{Binding WorkCount}"
                                     />


                        </StackPanel>
                        
                        <ProgressRing IsActive="{Binding NowWorking}" Margin="8" />

                    </StackPanel>
                                

                </Grid>
                
            </Grid>

        </ControlTemplate>
    </ContentControl.Template>
</ContentControl>
